<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>NURAI ‚Äî Hyper-Intelligent (sombre / online)</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
:root{
  --primary:#6C63FF; --accent:#36D1DC; --dark:#0F0F1A; --darker:#070712; --light:#F5F5F7;
  --card: linear-gradient(145deg,#232343,#1A1A2E);
  --shadow-soft: 0 4px 12px rgba(0,0,0,0.06);
}
*{box-sizing:border-box;margin:0;padding:0;font-family:"Segoe UI",Tahoma,Arial;}
html,body{height:100%;background:linear-gradient(180deg,#070712,#111126);color:var(--light);}
.app{display:flex;min-height:100vh;}
.sidebar{width:280px;padding:20px;background:var(--card);border-right:1px solid rgba(255,255,255,0.03);transform:perspective(1000px) rotateY(-5deg);transition:transform .35s;}
.sidebar:hover{transform:perspective(1000px) rotateY(0deg);}
.logo{display:flex;align-items:center;padding:8px;border-radius:10px;background:rgba(255,255,255,0.02);margin-bottom:18px}
.logo .fa-brain{font-size:22px;margin-right:10px;background:linear-gradient(90deg,var(--primary),var(--accent));-webkit-background-clip:text;-webkit-text-fill-color:transparent;}
.logo-text{font-weight:700;font-size:20px;background:linear-gradient(90deg,var(--primary),var(--accent));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.btn{display:inline-flex;align-items:center;gap:8px;padding:12px;border-radius:10px;border:0;cursor:pointer;font-weight:600}
.new-chat{width:100%;background:linear-gradient(135deg,var(--primary),var(--accent));color:#fff;margin-bottom:16px;box-shadow:var(--shadow-soft)}
.history-title{font-size:12px;color:#9aa0c3;margin:8px 0 10px}
.history{overflow:auto;max-height:60vh}
.history-item{padding:10px;border-radius:8px;margin-bottom:8px;background:rgba(255,255,255,0.02);cursor:pointer}
.history-item.active{background:rgba(108,99,255,0.12);border-left:3px solid var(--primary)}
.main{flex:1;padding:20px;display:flex;flex-direction:column;gap:16px}
.header{display:flex;justify-content:space-between;align-items:center;padding:12px;border-radius:12px;background:var(--card);box-shadow:var(--shadow-soft)}
.mode-select{display:flex;background:rgba(255,255,255,0.03);border-radius:10px;padding:6px}
.mode-btn{padding:8px 12px;border-radius:8px;border:0;background:none;color:var(--light);cursor:pointer;font-weight:600;display:flex;gap:8px;align-items:center}
.mode-btn.active{background:linear-gradient(135deg,var(--primary),var(--accent))}
.header-controls{display:flex;gap:10px}
.icon-btn{width:44px;height:44px;border-radius:10px;border:0;background:rgba(255,255,255,0.03);display:flex;align-items:center;justify-content:center;cursor:pointer}
.chat-area{flex:1;background:var(--card);border-radius:16px;padding:18px;display:flex;flex-direction:column;box-shadow:var(--shadow-soft);position:relative;overflow:hidden}
.chat-messages{flex:1;overflow:auto;padding-right:10px}
.message{max-width:85%;padding:14px 16px;border-radius:14px;margin:12px 0;line-height:1.5;position:relative}
.msg-user{margin-left:auto;background:linear-gradient(135deg,var(--primary),var(--accent));color:#fff;border-bottom-right-radius:6px}
.msg-bot{background:rgba(255,255,255,0.04);border-bottom-left-radius:6px}
.system-msg{background:rgba(255,204,0,0.08);color:#FFCC00;text-align:center;border-radius:10px}
.msg-header{font-size:13px;opacity:0.85;margin-bottom:8px;display:flex;align-items:center;gap:8px}
.msg-time{font-size:11px;opacity:0.65;margin-top:8px;text-align:right}
.input-area{display:flex;gap:12px;padding:12px;border-radius:12px;background:rgba(255,255,255,0.02);align-items:flex-end}
textarea{flex:1;min-height:64px;max-height:160px;padding:12px;border-radius:10px;border:0;background:rgba(255,255,255,0.03);color:var(--light);resize:none}
.send-btn{padding:12px 18px;border-radius:10px;background:linear-gradient(135deg,var(--primary),var(--accent));color:#fff;border:0;cursor:pointer}
.status-bar{display:flex;justify-content:space-between;align-items:center;padding:10px;border-radius:10px;background:rgba(255,255,255,0.02);font-size:13px;color:#9aa0c3}
.floating{position:absolute;pointer-events:none;z-index:0;opacity:0.03}
.floating.one{width:300px;height:300px;border-radius:50%;top:-140px;left:-140px;background:linear-gradient(135deg,var(--primary),var(--accent))}
.floating.two{width:200px;height:200px;border-radius:50%;top:10%;right:-80px;background:linear-gradient(135deg,var(--primary),var(--accent))}
.floating.three{width:150px;height:150px;border-radius:50%;bottom:6%;left:6%;background:linear-gradient(135deg,var(--primary),var(--accent))}
.typing-dots{display:inline-block;margin-left:8px}
.typing-dots span{display:inline-block;width:8px;height:8px;border-radius:50%;background:#9aa0c3;margin:0 2px;animation:blink 1.4s infinite}
.typing-dots span:nth-child(1){animation-delay:-0.32s} .typing-dots span:nth-child(2){animation-delay:-0.16s}
@keyframes blink{0%,80%,100%{transform:scale(0.8);opacity:0.5}40%{transform:scale(1);opacity:1}}
/* responsive */
@media (max-width:820px){.sidebar{display:none}.main{padding:12px}}
</style>
</head>
<body>
<div class="app" id="appRoot">
  <aside class="sidebar" id="sidebar">
    <div class="logo"><i class="fa-solid fa-brain"></i><div class="logo-text" style="margin-left:10px">NURAI</div></div>
    <button id="newChatBtn" class="btn new-chat"><i class="fa-solid fa-plus"></i> Nouvelle discussion</button>
    <div class="history-title">Historique</div>
    <div class="history" id="historyList">
      <div class="history-item active"><div style="font-weight:600">Nouvelle conversation</div><div style="font-size:12px;color:#9aa0c3">D√©marrer une conversation</div></div>
    </div>
  </aside>

  <main class="main">
    <header class="header">
      <div class="mode-select" role="tablist" aria-label="Modes">
        <button class="mode-btn active" data-mode="humain"><i class="fa-solid fa-user"></i> Humain</button>
        <button class="mode-btn" data-mode="expert"><i class="fa-solid fa-cogs"></i> Expert</button>
        <button class="mode-btn" data-mode="genie"><i class="fa-solid fa-magic"></i> G√©nie</button>
      </div>
      <div class="header-controls">
        <button id="themeToggle" class="icon-btn" title="Th√®me"><i class="fa-solid fa-moon"></i></button>
        <button id="settingsBtn" class="icon-btn" title="Param√®tres"><i class="fa-solid fa-gear"></i></button>
      </div>
    </header>

    <section class="chat-area" aria-live="polite">
      <div class="floating one"></div><div class="floating two"></div><div class="floating three"></div>
      <div class="chat-messages" id="chatMessages">
        <div class="message msg-bot">
          <div class="msg-header"><i class="fa-solid fa-robot"></i> NURAI Assistant</div>
          <div>üëã Salut ‚Äî je suis NURAI. Pose ta question, je ferai une recherche en ligne (Wikipedia, DuckDuckGo, Wikidata) et je raisonne pour te r√©pondre naturellement.</div>
          <div class="msg-time" id="initTime"></div>
        </div>
      </div>

      <div class="input-area" aria-label="Zone de saisie">
        <textarea id="messageInput" placeholder="√âcris ta question ici... (Entr√©e = envoyer, Shift+Entr√©e = nouvelle ligne)"></textarea>
        <button id="sendBtn" class="send-btn" title="Envoyer"><i class="fa-solid fa-paper-plane"></i> Envoyer</button>
      </div>
    </section>

    <div class="status-bar">
      <div><span style="display:inline-block;width:10px;height:10px;border-radius:50%;background:#4CD964;margin-right:8px"></span><span id="statusText">En ligne ‚Äî recherche web activ√©e</span></div>
      <div id="versionText">NURAI v6.1 ‚Äî Naturel ‚Ä¢ Sombre</div>
    </div>
  </main>
</div>

<script>
/*
  NURAI v6.1 - Complete corrected single-file.
  - Th√®me sombre par d√©faut.
  - Sources en ligne gratuites : Wikipedia (REST), DuckDuckGo Instant Answer, Wikidata SPARQL.
  - Google fallback : ouvre un onglet de recherche Google (pas d'API payante).
  - Mode par d√©faut : 'humain' (style naturel).
  - Robust event binding and safe error handling.
*/

/* ---------------- Helpers ---------------- */
const $ = (sel) => document.querySelector(sel);
const $all = (sel) => Array.from(document.querySelectorAll(sel));
const nowTime = () => new Date().toLocaleTimeString('fr-FR', {hour:'2-digit', minute:'2-digit'});

function safeFetch(url, options){
  return fetch(url, options).then(resp => resp.ok ? resp.json() : Promise.reject(resp.status));
}

function shortText(t, n=900){ return t && t.length>n ? t.slice(0,n)+'...' : t || ''; }
function rand(arr){ return arr[Math.floor(Math.random()*arr.length)]; }

/* ---------------- Memory ---------------- */
const Memory = {
  history: [],
  push(role, text){ this.history.push({t:new Date().toISOString(), role, text}); if(this.history.length>60) this.history.shift(); },
  last(n=6){ return this.history.slice(-n); },
  summary(){ // crude topic summary
    const map = {};
    this.history.forEach(h => {
      (h.text||'').toLowerCase().match(/\b([a-z√†-√ø]{4,})\b/gi)?.slice(-30).forEach(w => { map[w] = (map[w]||0)+1; });
    });
    return Object.keys(map).sort((a,b)=>map[b]-map[a]).slice(0,8).join(', ');
  }
};

/* ---------------- Web Sources ---------------- */
const Sources = {
  wikipediaSummary: async function(title){
    try{
      const url = 'https://fr.wikipedia.org/api/rest_v1/page/summary/' + encodeURIComponent(title);
      const r = await fetch(url);
      if(!r.ok) return null;
      return await r.json();
    }catch(e){ console.warn('wiki err', e); return null; }
  },

  duckDuckGoInstant: async function(q){
    try{
      // use allorigins proxy to avoid CORS issue
      const target = 'https://api.duckduckgo.com/?q=' + encodeURIComponent(q) + '&format=json&no_html=1';
      const url = 'https://api.allorigins.win/raw?url=' + encodeURIComponent(target);
      const r = await fetch(url);
      if(!r.ok) return null;
      return await r.json();
    }catch(e){ console.warn('ddg err', e); return null; }
  },

  wikidataSPARQL: async function(sparql){
    try{
      const url = 'https://query.wikidata.org/sparql?query=' + encodeURIComponent(sparql) + '&format=json';
      const r = await fetch(url, { headers: { 'Accept': 'application/sparql-results+json' }});
      if(!r.ok) return null;
      return await r.json();
    }catch(e){ console.warn('wd err', e); return null; }
  },

  webFallback: async function(query){
    // try wiki then ddg
    const wk = await this.wikipediaSummary(query);
    if(wk && wk.extract) return {source:'wikipedia', data:wk};
    const ddg = await this.duckDuckGoInstant(query);
    if(ddg && (ddg.AbstractText || (ddg.RelatedTopics && ddg.RelatedTopics.length))) return {source:'duckduckgo', data:ddg};
    return null;
  }
};

/* ---------------- Reasoning & Response Generation ---------------- */
const Reasoner = {
  detectIntent(text){
    const t = text.toLowerCase();
    if(/^(salut|bonjour|coucou|hey|hi|yo)\b/.test(t)) return 'greeting';
    if(/(calcule|r√©sous|int√©grale|d√©riv|√©quation|solve|sum|multiply)/.test(t)) return 'math';
    if(/(√©cris|compose|po√®me|raconte|cr√©e|histoire|imagine|si)/.test(t)) return 'creative';
    if(/(qui est|qu'est|c'est quoi|d√©finition|quel est|parle moi de|information)/.test(t)) return 'fact';
    return 'general';
  },

  guessEntity(text){
    const m = text.match(/(?:qui est|qui √©tait|qu'est[- ]ce que|c'est quoi|parle moi de)\s+(.{2,140})/i);
    if(m && m[1]) return m[1].replace(/^(le |la |les |un |une |de |du |des )/i,'').trim();
    if(text.split(/\s+/).length <=6) return text;
    return null;
  },

  async answer(input, mode){
    Memory.push('user', input);
    const intent = this.detectIntent(input);

    if(intent === 'greeting') return this._greeting(mode);

    // try entity-based web lookup for 'fact' type or short queries
    const entity = this.guessEntity(input);
    if(entity){
      const web = await Sources.webFallback(entity);
      if(web && web.data){
        const enriched = this._enrich(web, input, mode);
        Memory.push('assistant', shortText(enriched,1000));
        return enriched;
      }
    }

    if(intent === 'math'){
      const calc = this._compute(input);
      Memory.push('assistant', calc);
      return calc;
    }

    if(intent === 'creative'){
      const creative = this._creative(input, mode);
      Memory.push('assistant', shortText(creative,1000));
      return creative;
    }

    // general fallback: attempt DDG instant answer
    const ddg = await Sources.duckDuckGoInstant(input);
    if(ddg && (ddg.AbstractText || (ddg.RelatedTopics && ddg.RelatedTopics.length))){
      const text = ddg.AbstractText || (ddg.RelatedTopics[0] && ddg.RelatedTopics[0].Text) || '';
      const craft = this._composeFromText(input, text, mode);
      Memory.push('assistant', shortText(craft,1000));
      return craft;
    }

    // final fallback: synthesize a reasoned answer
    const synth = this._synthesize(input, mode);
    Memory.push('assistant', shortText(synth,1000));
    return synth;
  },

  _greeting(mode){
    const g = {
      humain: ['Salut ! Comment puis-je t‚Äôaider aujourd\'hui ?','Bonjour ! Que veux-tu savoir aujourd\'hui ?'],
      expert: ['Bonjour. Indique le probl√®me et les contraintes.','Mode expert activ√© ‚Äî donnez le sujet.'],
      genie: ['üßû‚Äç‚ôÇÔ∏è Le g√©nie est r√©veill√© ‚Äî parle !','‚ú® Que d√©sires-tu, mortel ?']
    };
    return rand(g[mode]);
  },

  _enrich(webResult, question, mode){
    const src = webResult.source;
    let content = '';
    if(src === 'wikipedia') content = webResult.data.extract || webResult.data.description || '';
    else if(src === 'duckduckgo') content = webResult.data.AbstractText || (webResult.data.RelatedTopics && webResult.data.RelatedTopics.map(t=>t.Text).join('\n')) || '';

    let intro = (mode === 'expert') ? `üîé Synth√®se (${src}) :\n\n` : (mode === 'genie' ? 'üßû‚Äç‚ôÇÔ∏è Le g√©nie dit :\n\n' : '');
    const inference = this._infer(content);

    return `${intro}${shortText(content,1300)}\n\n${inference}\n\nSource: ${src}`;
  },

  _infer(text){
    if(!text) return 'Aucune information d√©taill√©e trouv√©e.';
    const dates = (text.match(/\b(19\d{2}|20\d{2}|[0-3]?[0-9]\s?(janvier|f√©vrier|mars|avril|mai|juin|juillet|ao√ªt|septembre|octobre|novembre|d√©cembre))/gi)||[]).slice(0,6);
    const capitalized = (text.match(/\b[A-Z√â√à√Ä][a-z√©√®√†√¢√™√Æ√¥√ª√§√´√Ø√∂√º'‚Äô-]{2,}\b/g)||[]).slice(0,6);
    const parts = [];
    if(dates.length) parts.push('Dates rep√©r√©es: ' + dates.join(', '));
    if(capitalized.length) parts.push('Mots propres rep√©r√©s: ' + [...new Set(capitalized)].slice(0,6).join(', '));
    if(parts.length===0) return 'Aucune inf√©rence directe extraite ‚Äî le texte offre une description g√©n√©rale.';
    return parts.join(' ‚Ä¢ ');
  },

  _compute(expr){
    try{
      // very limited safe computation: allow digits, operators, parentheses, . and ^ for power
      const safe = expr.replace(/[^\d+\-*/().,^eE\s]/g,'');
      const js = safe.replace(/\^/g,'**');
      // Use Function constructor (safer than eval in this context) ‚Äî nonetheless limited
      const fn = new Function(`return (${js});`);
      const res = fn();
      if(typeof res === 'number' && isFinite(res)) return `R√©sultat : ${res}`;
      return "Impossible de calculer correctement cette expression.";
    }catch(e){ return "D√©sol√©, je n'ai pas pu calculer cette expression. Reformule-la simplement (ex: 2^10, 3*(4+5))."; }
  },

  _creative(prompt, mode){
    const opener = mode === 'genie' ? ['Par la lumi√®re des astres,','Au bord du silence,','√âcoute :'] :
                   (mode === 'expert' ? ['Synth√®se :','Proposition structur√©e :','R√©sum√© analytique :'] : ['Imagine ceci :','Voici une proposition :','Je te propose :']);
    const body = `${rand(opener)} ${prompt}\n\n(Ton: ${ mode==='genie' ? 'mystique' : mode==='expert' ? 'concis' : 'naturel' })\n\n` +
                 'Variations :\n1) ' + prompt.split(' ').slice(0,6).join(' ') + '... ' + rand(['avec une fin douce','avec un retournement','en version courte']) + '\n' +
                 '2) ' + prompt.split(' ').slice(1,7).join(' ') + '... ' + rand(['en style narratif','en style descriptif']) + '\n' +
                 '3) Transforme en une phrase punchy et m√©morable.';
    return body;
  },

  _composeFromText(query, text, mode){
    const header = mode === 'expert' ? 'R√âPONSE (analytique):\n' : mode === 'genie' ? 'üßû R√©ponse cr√©ative:\n' : 'R√©ponse:\n';
    const summary = text ? shortText(text,900) : "Aucune synth√®se trouv√©e directement.";
    const context = `Contexte r√©cent: ${Memory.summary() || '‚Äî'}`;
    return `${header}${summary}\n\n${context}\n\nSouhaites-tu des sources pr√©cises (Wikipedia / Wikidata) ?`;
  },

  _synthesize(query, mode){
    const steps = [
      '1) Clarifier le probl√®me',
      '2) Lister hypoth√®ses plausibles',
      '3) Proposer solutions ou interpr√©tations',
      '4) Conclusion synth√©tique'
    ].join('\n');
    const interpr = rand(['Il est probable que...','On peut supposer que...','Une piste raisonnable est...']);
    let out = `Pour ta question "${query}", voici une d√©marche possible :\n\n${steps}\n\nInterpr√©tation : ${interpr}\n\nConclusion : ${rand(['Approfondir avec des sources sp√©cialis√©es.','Voici une piste d‚Äôaction concr√®te.','La question reste ouverte.'])}`;
    if(mode==='genie') out = 'üßû‚Äç‚ôÇÔ∏è ' + out;
    if(mode==='expert') out = 'üî¨ ' + out;
    return out;
  }
};

/* ---------------- UI binding and logic (robust) ---------------- */
const UI = {
  mode: 'humain',
  inProgress: false,
  init(){
    // set initial time
    const t = $('#initTime'); if(t) t.textContent = nowTime();

    // bind elements safely
    const sendBtn = $('#sendBtn');
    const newChatBtn = $('#newChatBtn');
    const messageInput = $('#messageInput');
    const modeButtons = $all('.mode-btn');
    const themeToggle = $('#themeToggle');
    const settingsBtn = $('#settingsBtn');

    // click handlers
    sendBtn?.addEventListener('click', () => { this.handleSend(); });
    newChatBtn?.addEventListener('click', () => { this.clearConversation(); });
    messageInput?.addEventListener('keydown', (e) => {
      if(e.key === 'Enter' && !e.shiftKey){ e.preventDefault(); this.handleSend(); }
    });

    modeButtons.forEach(btn => {
      btn.addEventListener('click', (ev) => {
        modeButtons.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        this.mode = btn.dataset.mode || 'humain';
        this.systemMessage(`Mode chang√© : ${btn.textContent.trim()}`);
      });
    });

    themeToggle?.addEventListener('click', () => {
      // toggle icon and theme (simple: invert background/light)
      const icon = themeToggle.querySelector('i');
      if(icon.classList.contains('fa-moon')){
        icon.className = 'fa-solid fa-sun';
        document.documentElement.style.setProperty('background','#f5f7fb');
        document.body.style.background = 'linear-gradient(180deg,#fbfbfe,#f1f3fb)';
        this.systemMessage('Th√®me : clair (temporaire)');
      } else {
        icon.className = 'fa-solid fa-moon';
        document.documentElement.style.removeProperty('background');
        document.body.style.background = 'linear-gradient(180deg,#070712,#111126)';
        this.systemMessage('Th√®me : sombre');
      }
    });

    settingsBtn?.addEventListener('click', () => {
      this.systemMessage('‚öôÔ∏è Param√®tres: Recherche ‚Äî Wikipedia, DuckDuckGo, Wikidata. Google (ouvrir onglet) disponible.');
    });

    // initial UI hints
    this.systemMessage('NURAI pr√™t ‚Äî mode naturel (humain). Appuie Entr√©e pour envoyer.');
  },

  appendMessage({role='bot', text='', meta=''}){
    const container = $('#chatMessages');
    if(!container) return;
    const node = document.createElement('div');
    node.className = 'message ' + (role==='user' ? 'msg-user' : role==='system' ? 'system-msg' : 'msg-bot');
    const header = document.createElement('div');
    header.className = 'msg-header';
    header.innerHTML = role==='user' ? '<i class="fa-solid fa-user"></i> Vous' : role==='system' ? '' : '<i class="fa-solid fa-robot"></i> NURAI';
    const body = document.createElement('div');
    body.innerHTML = text.replace(/\n/g,'<br>');
    const time = document.createElement('div'); time.className = 'msg-time'; time.textContent = nowTime();
    if(header.textContent) node.appendChild(header);
    node.appendChild(body);
    node.appendChild(time);
    container.appendChild(node);
    container.scrollTop = container.scrollHeight;
  },

  systemMessage(txt){
    this.appendMessage({role:'system', text: txt});
  },

  clearConversation(){
    const cm = $('#chatMessages');
    if(cm) cm.innerHTML = '';
    Memory.history = [];
    // re-add welcome
    this.appendMessage({role:'bot', text:'üëã Nouvelle discussion ‚Äî pose ta question.'});
    this.systemMessage('Conversation r√©initialis√©e');
  },

  async handleSend(){
    if(this.inProgress) return;
    const input = $('#messageInput');
    if(!input) return;
    const raw = input.value.trim();
    if(!raw) return;
    this.appendMessage({role:'user', text: raw});
    input.value = '';
    this.inProgress = true;

    // typing indicator (system)
    const typingNode = document.createElement('div');
    typingNode.className = 'message system-msg';
    typingNode.innerHTML = `${this._typingText()} <span class="typing-dots"><span></span><span></span></span><div class="msg-time">${nowTime()}</div>`;
    $('#chatMessages')?.appendChild(typingNode);
    $('#chatMessages').scrollTop = $('#chatMessages').scrollHeight;

    try{
      const answer = await Reasoner.answer(raw, this.mode);
      // remove typing
      typingNode.remove();

      // if answer suggests lack of source and user maybe wants google, append a small Google button
      let finalAnswer = answer;
      // if web fallback null and user likely wants web, show google search suggestion
      const possibleEntity = Reasoner.guessEntity(raw);
      if(!possibleEntity && typeof answer === 'string' && answer.includes('Aucune information')) {
        finalAnswer += `\n\nJe peux aussi chercher sur Google : <a href="#" id="googleSearchLink">Ouvrir recherche Google</a>`;
      }

      this.appendMessage({role:'bot', text: finalAnswer});
      // attach event to google link if present
      setTimeout(()=> {
        const g = document.getElementById('googleSearchLink');
        if(g){
          g.addEventListener('click', (e) => {
            e.preventDefault();
            const q = encodeURIComponent(raw);
            window.open('https://www.google.com/search?q=' + q, '_blank');
          });
        }
      }, 50);
    }catch(e){
      console.error(e);
      typingNode.remove();
      this.appendMessage({role:'bot', text:'Erreur interne ‚Äî impossible de r√©pondre pour l‚Äôinstant.'});
    } finally {
      this.inProgress = false;
    }
  },

  _typingText(){ return this.mode === 'genie' ? '‚ú® Le g√©nie consulte...' : this.mode === 'expert' ? '‚ö° Analyse en cours...' : 'üîç Recherche et raisonnement...'; }
};

/* ---------------- Startup & Robust Init ---------------- */
(function bootstrap(){
  try{
    // Ensure DOM loaded
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', () => UI.init());
    } else {
      UI.init();
    }

    // safety: global click fallback (ensures buttons work even if other binding failed)
    document.addEventListener('click', (e) => {
      const s = e.target;
      if(s.closest && s.closest('#sendBtn')) { UI.handleSend(); }
      else if(s.closest && s.closest('#newChatBtn')) { UI.clearConversation(); }
      else if(s.closest && s.closest('.mode-btn')) {
        const btn = s.closest('.mode-btn');
        $all('.mode-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        UI.mode = btn.dataset.mode || 'humain';
        UI.systemMessage('Mode chang√©: ' + btn.textContent.trim());
      }
    });

  }catch(err){
    console.error('NURAI bootstrap error:', err);
    alert('Erreur lors de l\'initialisation de NURAI ‚Äî ouvre la console pour plus d\'infos.');
  }
})();
</script>
</body>
</html>

